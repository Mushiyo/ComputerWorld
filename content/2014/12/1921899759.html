title=〔開發誌〕無限愛樂電台過去節目表查詢
date=2014-12-03 23:40
full_date=2014-12-03T23:40:00.003+08:00
type=post
allowComment=true
tags=〔JavaScript〕, 〔開發誌〕, 【程式設計】
status=published
~~~~~~

這是今天花了點時間寫的小東西。<br /><br />網址：<a href="https://web-mushiyo.rhcloud.com/e-classical">https://web-mushiyo.rhcloud.com/e-classical</a><br /><br />source code：<br />由以下二個檔案組成，秉持本人對Java一貫的熱愛（實情是在不翻書的狀態下我只記得Java），後端仍舊使用JSP及servlet。<br /><ol><li><a href="https://github.com/Mushiyo/WebApp/blob/master/WebContent/e-classicalView.jsp">https://github.com/Mushiyo/WebApp/blob/master/WebContent/e-classicalView.jsp</a></li><li><a href="https://github.com/Mushiyo/WebApp/blob/master/src/e_classical/e_classical.java">https://github.com/Mushiyo/WebApp/blob/master/src/e_classical/e_classical.java</a></li></ol><br /><!--more-->　　今年年初的某天我在愛樂電台聽到一首很棒的曲子，因為很想知道它叫什麼名字，於是就將節目播出的時間記下來，想說等有空的時候上網查。結果，等我想起這件事的時候，已經過了七天，電台網站上已經查不到了……<br />　　但我還是不死心的想知道曲名，於是便開始Google，想說搞不好在其他地方會有節目表。在關鍵字狂下，亂搜了一陣之後還真的給我找到了一個神奇網址（以我的功力無法從電台網站上找到的網址。）──原來電台網站還是可以查到七天前的節目資訊的，只是要從這個網址下手，修改一下上面的數字才可以。順利查到曲名後，我就把這個神奇網址記下來備用。前天再次看到它，突然想到：何不做成一個查詢介面，這樣就不用記下神奇網址，也不用手動改數字了。心頭一熱，今天就花了一點時間把它生出來。<br />　　整個架構其實還滿簡單的，就只有輸入日期和時間，然後把顯示那天節目資訊的神奇網址變出來再開新視窗顯示內容。不過由於我對寫網頁不是很熟，所以還是到處找資料東拼西湊的才把它弄出來，也因此在過程中學了點東西。底下是開發中遇到的問題與解法，暨學到的東西的記錄。<br /><br />1.&nbsp;日期選擇器<br />我本來是想找現成的JavaScript code來修改，不過根據過去的印象，能正確運作的很難找。而我本身不熟悉JavaScript，就算找到了，有沒有辦法修改，以及修改後是否能正確運作還是個問題。後來看到不少人推JQuery的<a href="http://jqueryui.com/datepicker/" target="_blank">Datepicker</a>，看了一下覺得簡單易用，便決定採用這個方案。<br />它的用法是，先在&lt;head&gt;間加入如下程式碼：<br /><script src="http://cdnjs.cloudflare.com/ajax/libs/SyntaxHighlighter/3.0.83/scripts/shBrushXml.js" type="text/javascript"></script><br /><pre class="brush: js; html-script: true; highlight: [6]">&lt;link rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css"&gt;<br />&lt;script src="//code.jquery.com/jquery-1.10.2.js"&gt;&lt;/script&gt;<br />&lt;script src="//code.jquery.com/ui/1.11.2/jquery-ui.js"&gt;&lt;/script&gt;<br />&lt;script&gt;<br />    $(function() {<br />        $("#datepicker").datepicker({dateFormat: 'yy/mm/dd', minDate: new Date(2000, 3 - 1, 26), maxDate: '0'});<br />    });<br />&lt;/script&gt;<br /></pre>其中第6行的<a href="http://api.jqueryui.com/datepicker/#option-dateFormat" rel="nofollow" target="_blank">dateFormat</a>是用來設定日期的顯示格式，<a href="http://api.jqueryui.com/datepicker/#option-minDate" rel="nofollow" target="_blank">minDate</a>則是可以選擇的最早的日期，<a href="http://api.jqueryui.com/datepicker/#option-maxDate" rel="nofollow" target="_blank">maxDate</a>則是可以選擇最後日期。這邊把maxDate設為0表示可以選擇的最晚日期是今天。<br />接著在&lt;body&gt;之間加入以下的code：<br /><pre class="brush: html">&lt;input type="text" name="date" id="datepicker"&gt;<br /></pre>這樣就完成了<br /><br />2.&nbsp;開新視窗顯示網頁<br />本來想說用JSP或servlet就可做到，但在搜尋該怎麼寫的時候，發現全部都是建議用JavaScript，所以我也用JavaScript了。<br />語法如下：<br /><pre class="brush: js; html-script: true">&lt;script&gt;<br />    window.open("欲開啟的網址");<br />&lt;/script&gt;<br /></pre><br />3.&nbsp;設定預設值<br />我希望使用者在按下「查詢」後，輸入的值還是保留在框內。因此，在control處理完post，將畫面重新導回view的時候，要將view的輸入內容設成跟使用者發出請求時一模一樣。<br />Datepicker設定預設值的方法為用<a href="http://api.jqueryui.com/datepicker/#method-setDate" rel="nofollow" target="_blank">setDate</a>：<br /><pre class="brush: js; html-script: true">&lt;script&gt;<br />    $(function() {<br />        $("#datepicker").datepicker("setDate", "&lt;%=request.getParameter("date")%&gt;");<br />    });<br />&lt;/script&gt;<br /></pre>值得注意的是，Datepicker有一個叫<a href="http://api.jqueryui.com/datepicker/#option-defaultDate" rel="nofollow" target="_blank">defaultDate</a>的option，可是這個似乎不是用來設定預設值的，至少我用它設都失敗。（如果你知道如何用defaultDate設預設值，歡迎留言告訴我。）<br /><br />HTML的&lt;select&gt;用設預設值的方法則是用JavaScript來完成比較簡單，語法如下：<br /><pre class="brush: js; html-script: true">&lt;script&gt;<br />    $(function() {<br />        $("#select tag的id名稱").val("欲設定的option的value");<br />    });<br />&lt;/script&gt;</pre><br />上面三點搞定後，再用JSP及servlet穿針引線一番就完成了。由於內容簡單，一次就寫完了，以後除了美化介面或去除不好的寫法外，應該就沒有其他更新的餘地，所以就沒<strike>亂</strike>下版本號了。<br /><br />以上就是這次的開發誌。其實我覺得對會自己修改網址來查詢的人來說，直接手動修改會比用這個還快XD。不過寫這個東西的目的從一開始就是開心+學習啦，至於有沒有幫到別人就是其次的問題了。另外，老實說我不確定像這樣「用自己的介面，導向別人的網站」的做法會不會有法律上的虞慮，如果你是電台的人，覺得這樣做損害到你們的權益，或是你懂法律，知道這樣做是不行的，皆歡迎留言在下面，我看到後會立刻把它從網路上拿掉。有其他意見也歡迎留言。謝謝收看這有點長的文章！
